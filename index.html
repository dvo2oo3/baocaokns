<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°o C√°o Ti·∫øn ƒê·ªô C√†i Ph·∫ßn M·ªÅm</title>
    <link rel="icon" type="image/png" href="·∫¢nh2.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        /* WEATHER BACKGROUND */
        #weatherBackground {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            transition: all 1s ease;
        }
        
        /* Rain effect */
        .rain {
            position: absolute;
            width: 2px;
            height: 60px;
            background: linear-gradient(transparent, rgba(255, 255, 255, 0.6));
            animation: fall linear infinite;
        }
        @keyframes fall {
            to { transform: translateY(100vh); }
        }
        
        /* Snow effect */
        .snow {
            position: absolute;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: snowfall linear infinite;
            opacity: 0.8;
        }
        @keyframes snowfall {
            to { 
                transform: translateY(100vh) translateX(20px);
                opacity: 0;
            }
        }
        
        /* Cloud effect */
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 100px;
            animation: float linear infinite;
        }
        @keyframes float {
            to { transform: translateX(100vw); }
        }
        
        /* Sun/Moon */
        .celestial {
            position: absolute;
            top: 50px;
            right: 80px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            transition: all 1s ease;
            box-shadow: 0 0 60px rgba(255, 200, 0, 0.5);
        }
        
        /* Lightning effect */
        .lightning {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0);
            pointer-events: none;
            animation: flash 0.2s ease-in-out;
        }
        @keyframes flash {
            0%, 100% { background: rgba(255, 255, 255, 0); }
            50% { background: rgba(255, 255, 255, 0.5); }
        }
        
        /* Fog effect */
        .fog {
            position: absolute;
            width: 100%;
            height: 300px;
            background: linear-gradient(to bottom, rgba(200, 200, 200, 0.4), transparent);
            animation: fogMove 20s ease-in-out infinite;
        }
        @keyframes fogMove {
            0%, 100% { opacity: 0.3; transform: translateX(-50px); }
            50% { opacity: 0.6; transform: translateX(50px); }
        }
        
        /* Stars for night mode */
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* Theme toggle button */
        .theme-toggle {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            font-size: 14px;
        }
        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .weather-info {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 10px 18px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-weight: 600;
        }
        body.dark-mode .weather-info {
            background: rgba(30, 30, 45, 0.9);
            color: #e5e7eb;
        }
        
        /* Mobile adjustments */
        @media (max-width: 640px) {
            .theme-toggle {
                padding: 10px 16px;
                font-size: 13px;
            }
            .weather-info {
                padding: 8px 14px;
            }
        }
        
        /* Dark mode adjustments */
        body.dark-mode {
            color: #e5e7eb;
        }
        body.dark-mode .glass-effect {
            background: rgba(30, 30, 45, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        body.dark-mode .stat-card {
            opacity: 0.95;
        }
        body.dark-mode .text-gray-600 {
            color: #ffffff !important;
        }
        body.dark-mode .text-gray-700 {
            color: #000000 !important;
        }
        body.dark-mode .text-gray-800 {
            color: #e5e7eb !important;
        }
        body.dark-mode .theme-toggle {
            background: rgba(30, 30, 45, 0.9);
            color: #e5e7eb;
        }
        
        /* Dark mode for "Ph√¢n B·ªï S·ªë Ti·∫øt" section */
        body.dark-mode .stat-card.glass-effect {
            background: rgba(30, 30, 45, 0.85);
            border-color: rgba(255, 255, 255, 0.1);
        }
        body.dark-mode .text-blue-900 {
            color: #93c5fd !important;
        }
        body.dark-mode .text-blue-700 {
            color: #93c5fd !important;
        }
        body.dark-mode .text-green-900 {
            color: #86efac !important;
        }
        body.dark-mode .text-green-700 {
            color: #86efac !important;
        }
        body.dark-mode .text-yellow-900 {
            color: #fde047 !important;
        }
        body.dark-mode .text-yellow-700 {
            color: #fde047 !important;
        }
        body.dark-mode .bg-blue-100 {
            background: rgba(59, 130, 246, 0.2) !important;
        }
        body.dark-mode .bg-green-100 {
            background: rgba(34, 197, 94, 0.2) !important;
        }
        body.dark-mode .bg-yellow-100 {
            background: rgba(251, 191, 36, 0.2) !important;
        }
        
        .stat-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.3);
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .section-divider {
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.5), transparent);
            margin: 2rem 0;
        }
        
        /* COUNTDOWN - PREMIUM REDESIGN */
        .countdown-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .countdown-container.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }
        
        /* Circular countdown */
        .countdown-circle {
            position: relative;
            width: 48px;
            height: 48px;
            flex-shrink: 0;
        }
        .countdown-circle svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }
        .countdown-circle-bg {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 4;
        }
        .countdown-circle-progress {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 4;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s linear;
            filter: drop-shadow(0 0 6px rgba(16, 185, 129, 0.5));
        }
        .countdown-circle-progress.warning {
            stroke: url(#gradientWarning);
            animation: pulse-stroke 0.6s ease-in-out infinite;
        }
        @keyframes pulse-stroke {
            0%, 100% { 
                filter: drop-shadow(0 0 6px rgba(239, 68, 68, 0.6));
            }
            50% { 
                filter: drop-shadow(0 0 12px rgba(239, 68, 68, 1));
            }
        }
        .countdown-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            font-weight: 800;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.3s ease;
        }
        .countdown-number.warning {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: bounce-number 0.6s ease-in-out infinite;
        }
        @keyframes bounce-number {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.15); }
        }
        
        /* Text label - Hide on mobile */
        .countdown-label {
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            display: none;
            flex-direction: column;
            gap: 2px;
        }
        @media (min-width: 640px) {
            .countdown-label {
                display: flex;
            }
        }
        .countdown-label-main {
            font-size: 12px;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .countdown-label-sub {
            font-size: 14px;
            font-weight: 700;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .countdown-label-sub.warning {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* STATUS BADGE - PREMIUM */
        .status-badge {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .status-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }
        .status-badge.loading {
            background: linear-gradient(270deg, #fef3c7, #fde68a, #fcd34d, #fde68a, #fef3c7);
            background-size: 400% 100%;
            animation: shimmer-bg 2s ease-in-out infinite;
            color: #92400e;
            border: 2px solid #fbbf24;
        }
        .status-badge.loading::before {
            animation: shimmer-overlay 2s infinite;
        }
        @keyframes shimmer-overlay {
            0% { left: -100%; }
            100% { left: 200%; }
        }
        .status-badge.success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border: 2px solid #10b981;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        .status-badge.success .status-dot {
            animation: success-pulse 2s ease-in-out infinite;
        }
        @keyframes success-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            50% { 
                transform: scale(1.2);
                box-shadow: 0 0 0 8px rgba(16, 185, 129, 0);
            }
        }
        .status-badge.error {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 2px solid #ef4444;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: currentColor;
        }
        @keyframes shimmer-bg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* BUTTONS */
        .btn-auto {
            position: relative;
            overflow: hidden;
        }
        .btn-auto::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        .btn-auto.active::before {
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        .btn-refresh {
            position: relative;
            overflow: hidden;
        }
        .btn-refresh::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn-refresh:active::after {
            width: 300px;
            height: 300px;
        }
        .refresh-icon {
            transition: all 0.3s ease;
            display: inline-block;
        }
        .refresh-icon.spinning {
            animation: smoothSpin 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes smoothSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.3); }
            100% { transform: rotate(360deg) scale(1); }
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 transition-colors duration-1000">
    <!-- Weather Background -->
    <div id="weatherBackground"></div>
    
    <div class="max-w-7xl mx-auto">
        
        <!-- Header -->
        <div class="glass-effect rounded-3xl shadow-2xl p-6 md:p-8 mb-8 fade-in">
            <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6">
                <div class="flex-1">
                    <div class="flex items-center gap-4 mb-3">
                        <div class="bg-gradient-to-br from-indigo-500 to-purple-600 p-4 rounded-2xl shadow-xl">
                            <span class="text-5xl">üìö</span>
                        </div>
                        <div>
                            <h1 class="text-3xl md:text-5xl font-black bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent leading-tight">
                                Ti·∫øn ƒê·ªô C√†i ƒê·∫∑t
                            </h1>
                            <p class="text-gray-600 mt-2 font-semibold text-lg">Ph·∫ßn M·ªÅm K·ªπ NƒÉng S·ªëng</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3 mt-4">
                        <div id="statusBadge" class="status-badge loading">
                            <div class="status-dot"></div>
                            <span id="lastUpdate">ƒêang t·∫£i d·ªØ li·ªáu...</span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2 sm:gap-3 items-center flex-wrap sm:flex-nowrap">
                    <div id="countdownContainer" class="countdown-container">
                        <div class="countdown-circle">
                            <svg viewBox="0 0 48 48">
                                <defs>
                                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                                    </linearGradient>
                                    <linearGradient id="gradientWarning" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="countdown-circle-bg" cx="24" cy="24" r="20"></circle>
                                <circle id="countdownCircle" class="countdown-circle-progress" cx="24" cy="24" r="20" 
                                    stroke-dasharray="125.66" stroke-dashoffset="0"></circle>
                            </svg>
                            <div id="countdownNumber" class="countdown-number">10</div>
                        </div>
                        <div class="countdown-label">
                            <span class="countdown-label-main">C·∫≠p nh·∫≠t</span>
                            <span id="countdownText" class="countdown-label-sub">sau 10s</span>
                        </div>
                    </div>
                    <button 
                        onclick="toggleAutoRefresh()" 
                        id="autoRefreshBtn"
                        class="btn-auto active flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl font-semibold transition-all shadow-lg hover:shadow-2xl border-2 border-green-400">
                        <span id="autoRefreshIcon" class="text-lg sm:text-xl">‚ñ∂Ô∏è</span>
                        <span class="hidden sm:inline font-bold">Auto</span>
                    </button>
                    <button 
                        onclick="manualRefresh()" 
                        id="refreshBtn"
                        class="btn-refresh flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-xl font-bold transition-all shadow-lg hover:shadow-2xl hover:scale-105">
                        <span id="refreshIcon" class="text-lg sm:text-xl refresh-icon">üîÑ</span>
                        <span class="text-sm sm:text-base">L√†m m·ªõi</span>
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <span id="themeIcon">üåô</span>
                        <span id="themeText" class="hidden sm:inline">Ch·∫ø ƒë·ªô t·ªëi</span>
                    </button>
                    <div class="weather-info">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span id="weatherIcon" style="font-size: 20px;">üå§Ô∏è</span>
                            <div class="hidden sm:block">
                                <div id="weatherDesc" style="font-size: 13px;">ƒêang t·∫£i...</div>
                                <div id="weatherTemp" style="font-size: 11px; opacity: 0.7;">H√† N·ªôi</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PH·∫¶N 1: TH·ªêNG K√ä TR∆Ø·ªúNG -->
        <div class="mb-6 md:mb-8 fade-in">
            <div class="flex items-center gap-2 md:gap-3 mb-4 md:mb-6">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-1.5 md:p-2 rounded-lg">
                    <span class="text-xl md:text-2xl">üè´</span>
                </div>
                <h2 class="text-xl md:text-3xl font-black bg-gradient-to-r from-blue-600 to-blue-700 bg-clip-text text-transparent">
                    Th·ªëng K√™ Tr∆∞·ªùng
                </h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                <div class="stat-card bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl md:rounded-2xl shadow-xl p-5 md:p-8 text-white">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <span class="text-3xl md:text-5xl">üè´</span>
                        <div class="bg-white bg-opacity-25 rounded-lg md:rounded-xl px-2 md:px-4 py-1 md:py-2">
                            <span class="text-xs md:text-sm font-black">TOTAL</span>
                        </div>
                    </div>
                    <h3 class="text-sm md:text-base font-bold opacity-90 mb-2 md:mb-3">T·ªïng s·ªë tr∆∞·ªùng</h3>
                    <p class="text-4xl md:text-6xl font-black mb-1 md:mb-2" id="totalSchools">192</p>
                    <p class="text-xs md:text-sm opacity-80">tr∆∞·ªùng ƒëƒÉng k√Ω</p>
                </div>

                <div class="stat-card bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl md:rounded-2xl shadow-xl p-5 md:p-8 text-white">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <span class="text-3xl md:text-5xl">‚úÖ</span>
                        <div class="bg-white bg-opacity-25 rounded-lg md:rounded-xl px-2 md:px-4 py-1 md:py-2">
                            <span class="text-xs md:text-sm font-black" id="schoolPercent">0%</span>
                        </div>
                    </div>
                    <h3 class="text-sm md:text-base font-bold opacity-90 mb-2 md:mb-3">Tr∆∞·ªùng ƒë√£ c√†i</h3>
                    <p class="text-4xl md:text-6xl font-black mb-1 md:mb-2" id="schoolsInstalled">0</p>
                    <p class="text-xs md:text-sm opacity-80" id="schoolsInstalledSub">0/192</p>
                </div>

                <div class="stat-card bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl md:rounded-2xl shadow-xl p-5 md:p-8 text-white">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <span class="text-3xl md:text-5xl">üíª</span>
                        <div class="bg-white bg-opacity-25 rounded-lg md:rounded-xl px-2 md:px-4 py-1 md:py-2">
                            <span class="text-xs md:text-sm font-black">PC</span>
                        </div>
                    </div>
                    <h3 class="text-sm md:text-base font-bold opacity-90 mb-2 md:mb-3">Tr∆∞·ªùng m√°y > 10</h3>
                    <p class="text-4xl md:text-6xl font-black mb-1 md:mb-2" id="moreThan10">0</p>
                    <p class="text-xs md:text-sm opacity-80">tr∆∞·ªùng</p>
                </div>
            </div>

            <div class="mt-4 md:mt-6 glass-effect rounded-xl md:rounded-2xl shadow-xl p-4 md:p-6">
                <div class="flex items-center justify-between mb-3 md:mb-4">
                    <h3 class="text-base md:text-xl font-black text-gray-800">Ti·∫øn ƒë·ªô tr∆∞·ªùng</h3>
                    <span class="text-2xl md:text-3xl font-black bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent" id="installProgress">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-5 md:h-6 overflow-hidden">
                    <div id="installProgressBar" class="bg-gradient-to-r from-blue-500 to-indigo-600 h-5 md:h-6 rounded-full transition-all duration-1000 ease-out shadow-lg flex items-center justify-end pr-2 md:pr-3" style="width: 0%">
                        <span class="text-white text-xs font-bold" id="installProgressText"></span>
                    </div>
                </div>
                <p class="text-xs md:text-sm text-gray-600 mt-2" id="installProgressSub">0/192 tr∆∞·ªùng</p>
            </div>
        </div>

        <div class="section-divider"></div>

        <!-- PH·∫¶N 2: TH·ªêNG K√ä GI√ÅO VI√äN -->
        <div class="mb-6 md:mb-8 fade-in">
            <div class="flex items-center gap-2 md:gap-3 mb-4 md:mb-6">
                <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-1.5 md:p-2 rounded-lg">
                    <span class="text-xl md:text-2xl">üë•</span>
                </div>
                <h2 class="text-xl md:text-3xl font-black bg-gradient-to-r from-green-600 to-emerald-700 bg-clip-text text-transparent">
                    Th·ªëng K√™ Gi√°o Vi√™n
                </h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                <div class="stat-card bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl md:rounded-2xl shadow-xl p-5 md:p-8 text-white">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <span class="text-3xl md:text-5xl">üë•</span>
                        <div class="bg-white bg-opacity-25 rounded-lg md:rounded-xl px-2 md:px-4 py-1 md:py-2">
                            <span class="text-xs md:text-sm font-black">TOTAL</span>
                        </div>
                    </div>
                    <h3 class="text-sm md:text-base font-bold opacity-90 mb-2 md:mb-3">GV ƒëƒÉng k√Ω</h3>
                    <p class="text-4xl md:text-6xl font-black mb-1 md:mb-2" id="registered">0</p>
                    <p class="text-xs md:text-sm opacity-80">gi√°o vi√™n</p>
                </div>

                <div class="stat-card bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl md:rounded-2xl shadow-xl p-5 md:p-8 text-white">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <span class="text-3xl md:text-5xl">‚úÖ</span>
                        <div class="bg-white bg-opacity-25 rounded-lg md:rounded-xl px-2 md:px-4 py-1 md:py-2">
                            <span class="text-xs md:text-sm font-black" id="installedPercent">0%</span>
                        </div>
                    </div>
                    <h3 class="text-sm md:text-base font-bold opacity-90 mb-2 md:mb-3">GV ƒë√£ c√†i</h3>
                    <p class="text-4xl md:text-6xl font-black mb-1 md:mb-2" id="installed">0</p>
                    <p class="text-xs md:text-sm opacity-80" id="installedSub">0/0</p>
                </div>

                <div class="stat-card bg-gradient-to-br from-orange-500 to-red-500 rounded-xl md:rounded-2xl shadow-xl p-5 md:p-8 text-white">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <span class="text-3xl md:text-5xl">‚è≥</span>
                        <div class="bg-white bg-opacity-25 rounded-lg md:rounded-xl px-2 md:px-4 py-1 md:py-2">
                            <span class="text-xs md:text-sm font-black" id="remainingPercent2">0%</span>
                        </div>
                    </div>
                    <h3 class="text-sm md:text-base font-bold opacity-90 mb-2 md:mb-3">GV ch∆∞a c√†i</h3>
                    <p class="text-4xl md:text-6xl font-black mb-1 md:mb-2" id="remaining">0</p>
                    <p class="text-xs md:text-sm opacity-80">gi√°o vi√™n</p>
                </div>
            </div>

            <div class="mt-4 md:mt-6 glass-effect rounded-xl md:rounded-2xl shadow-xl p-4 md:p-6">
                <div class="flex items-center justify-between mb-3 md:mb-4">
                    <h3 class="text-base md:text-xl font-black text-gray-800">Ti·∫øn ƒë·ªô gi√°o vi√™n</h3>
                    <span class="text-2xl md:text-3xl font-black bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent" id="teacherProgress">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-5 md:h-6 overflow-hidden">
                    <div id="teacherProgressBar" class="bg-gradient-to-r from-green-500 to-emerald-600 h-5 md:h-6 rounded-full transition-all duration-1000 ease-out shadow-lg flex items-center justify-end pr-2 md:pr-3" style="width: 0%">
                        <span class="text-white text-xs font-bold" id="teacherProgressText"></span>
                    </div>
                </div>
                <p class="text-xs md:text-sm text-gray-600 mt-2" id="teacherProgressSub">0/0 GV</p>
            </div>
        </div>

        <div class="section-divider"></div>

        <!-- PH·∫¶N 3: PH√ÇN B·ªî S·ªê TI·∫æT -->
        <div class="mb-6 md:mb-8 fade-in">
            <div class="flex items-center gap-2 md:gap-3 mb-4 md:mb-6">
                <div class="bg-gradient-to-r from-yellow-500 to-orange-500 p-1.5 md:p-2 rounded-lg">
                    <span class="text-xl md:text-2xl">üìñ</span>
                </div>
                <h2 class="text-xl md:text-3xl font-black bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent">
                    Ph√¢n B·ªï S·ªë Ti·∫øt
                </h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                <div class="stat-card glass-effect rounded-xl md:rounded-2xl shadow-xl p-5 md:p-8 border-2 md:border-4 border-blue-200">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <div class="flex items-center gap-2 md:gap-3">
                            <div class="bg-gradient-to-br from-blue-400 to-blue-600 p-2 md:p-4 rounded-lg md:rounded-xl shadow-lg">
                                <span class="text-2xl md:text-4xl">üìò</span>
                            </div>
                            <h3 class="text-lg md:text-2xl font-black text-blue-900">36 ti·∫øt</h3>
                        </div>
                        <div class="bg-blue-100 rounded-lg md:rounded-xl px-2 md:px-4 py-1 md:py-2">
                            <span class="text-xs md:text-base font-black text-blue-700" id="percent36">0%</span>
                        </div>
                    </div>
                    <p class="text-4xl md:text-6xl font-black text-blue-900 mb-2 md:mb-3" id="install36">0</p>
                    <p class="text-sm md:text-base text-blue-700 font-bold">tr∆∞·ªùng ƒëƒÉng k√Ω</p>
                </div>
                
                <div class="stat-card glass-effect rounded-xl md:rounded-2xl shadow-xl p-5 md:p-8 border-2 md:border-4 border-green-200">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <div class="flex items-center gap-2 md:gap-3">
                            <div class="bg-gradient-to-br from-green-400 to-green-600 p-2 md:p-4 rounded-lg md:rounded-xl shadow-lg">
                                <span class="text-2xl md:text-4xl">üìó</span>
                            </div>
                            <h3 class="text-lg md:text-2xl font-black text-green-900">72 ti·∫øt</h3>
                        </div>
                        <div class="bg-green-100 rounded-lg md:rounded-xl px-2 md:px-4 py-1 md:py-2">
                            <span class="text-xs md:text-base font-black text-green-700" id="percent72">0%</span>
                        </div>
                    </div>
                    <p class="text-4xl md:text-6xl font-black text-green-900 mb-2 md:mb-3" id="install72">0</p>
                    <p class="text-sm md:text-base text-green-700 font-bold">tr∆∞·ªùng ƒëƒÉng k√Ω</p>
                </div>
                
                <div class="stat-card glass-effect rounded-xl md:rounded-2xl shadow-xl p-5 md:p-8 border-2 md:border-4 border-yellow-200">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <div class="flex items-center gap-2 md:gap-3">
                            <div class="bg-gradient-to-br from-yellow-400 to-orange-500 p-2 md:p-4 rounded-lg md:rounded-xl shadow-lg">
                                <span class="text-2xl md:text-4xl">üìô</span>
                            </div>
                            <h3 class="text-lg md:text-2xl font-black text-yellow-900">108 ti·∫øt</h3>
                        </div>
                        <div class="bg-yellow-100 rounded-lg md:rounded-xl px-2 md:px-4 py-1 md:py-2">
                            <span class="text-xs md:text-base font-black text-yellow-700" id="percent108">0%</span>
                        </div>
                    </div>
                    <p class="text-4xl md:text-6xl font-black text-yellow-900 mb-2 md:mb-3" id="install108">0</p>
                    <p class="text-sm md:text-base text-yellow-700 font-bold">tr∆∞·ªùng ƒëƒÉng k√Ω</p>
                </div>
            </div>
        </div>

        <div class="section-divider"></div>

        <!-- BI·ªÇU ƒê·ªí -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8 fade-in">
            <!-- Bi·ªÉu ƒë·ªì Tr∆∞·ªùng -->
            <div class="glass-effect rounded-xl md:rounded-2xl shadow-2xl p-4 md:p-6">
                <div class="flex items-center justify-between mb-4 md:mb-6">
                    <h2 class="text-lg md:text-2xl font-black bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent flex items-center gap-2 md:gap-3">
                        <span class="text-2xl md:text-3xl">üè´</span>
                        <span>Th·ªëng k√™ Tr∆∞·ªùng</span>
                    </h2>
                </div>
                <div style="height: 280px; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 0.75rem; padding: 1rem;">
                    <canvas id="schoolChart"></canvas>
                </div>
            </div>
            
            <!-- Bi·ªÉu ƒë·ªì Gi√°o vi√™n -->
            <div class="glass-effect rounded-xl md:rounded-2xl shadow-2xl p-4 md:p-6">
                <div class="flex items-center justify-between mb-4 md:mb-6">
                    <h2 class="text-lg md:text-2xl font-black bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent flex items-center gap-2 md:gap-3">
                        <span class="text-2xl md:text-3xl">üë•</span>
                        <span>Th·ªëng k√™ GV</span>
                    </h2>
                </div>
                <div style="height: 280px; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 0.75rem; padding: 1rem;">
                    <canvas id="teacherChart"></canvas>
                </div>
            </div>
            
            <!-- Bi·ªÉu ƒë·ªì Ph√¢n b·ªï s·ªë ti·∫øt -->
            <div class="glass-effect rounded-xl md:rounded-2xl shadow-2xl p-4 md:p-6">
                <div class="flex items-center justify-between mb-4 md:mb-6">
                    <h2 class="text-lg md:text-2xl font-black bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent flex items-center gap-2 md:gap-3">
                        <span class="text-2xl md:text-3xl">ü•ß</span>
                        <span>Ph√¢n b·ªï s·ªë ti·∫øt</span>
                    </h2>
                </div>
                <div style="height: 280px; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 0.75rem; padding: 1rem;">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </div>

        <!-- PH√ÇN T√çCH N√ÇNG CAO -->
        <div class="glass-effect rounded-xl md:rounded-3xl shadow-2xl p-5 md:p-8 fade-in">
            <h2 class="text-xl md:text-3xl font-black text-center mb-5 md:mb-8 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                üìà Ph√¢n T√≠ch N√¢ng Cao
            </h2>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6">
                <div class="text-center bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl md:rounded-2xl p-4 md:p-6 border-2 border-blue-300">
                    <div class="text-3xl md:text-5xl mb-2 md:mb-4">üè´</div>
                    <p class="text-gray-700 text-xs md:text-sm font-bold mb-2 md:mb-3">T·ª∑ l·ªá tr∆∞·ªùng</p>
                    <p class="text-3xl md:text-5xl font-black bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-1 md:mb-2" id="schoolCompletionRate">0%</p>
                    <p class="text-xs text-gray-600 font-semibold" id="schoolCompletionSub">0/192</p>
                </div>
                <div class="text-center bg-gradient-to-br from-green-50 to-green-100 rounded-xl md:rounded-2xl p-4 md:p-6 border-2 border-green-300">
                    <div class="text-3xl md:text-5xl mb-2 md:mb-4">üë®‚Äçüè´</div>
                    <p class="text-gray-700 text-xs md:text-sm font-bold mb-2 md:mb-3">T·ª∑ l·ªá GV</p>
                    <p class="text-3xl md:text-5xl font-black bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent mb-1 md:mb-2" id="teacherCompletionRate">0%</p>
                    <p class="text-xs text-gray-600 font-semibold" id="teacherCompletionSub">0/0</p>
                </div>
                <div class="text-center bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl md:rounded-2xl p-4 md:p-6 border-2 border-purple-300">
                    <div class="text-3xl md:text-5xl mb-2 md:mb-4">‚ö°</div>
                    <p class="text-gray-700 text-xs md:text-sm font-bold mb-2 md:mb-3">T·ªëc ƒë·ªô</p>
                    <p class="text-2xl md:text-4xl font-black bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-1 md:mb-2" id="deploymentSpeed">-</p>
                    <p class="text-xs text-gray-600 font-semibold">GV/ng√†y</p>
                </div>
                <div class="text-center bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl md:rounded-2xl p-4 md:p-6 border-2 border-orange-300">
                    <div class="text-3xl md:text-5xl mb-2 md:mb-4">üìÖ</div>
                    <p class="text-gray-700 text-xs md:text-sm font-bold mb-2 md:mb-3">Ho√†n th√†nh</p>
                    <p class="text-2xl md:text-4xl font-black bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent mb-1 md:mb-2" id="estimatedCompletion">-</p>
                    <p class="text-xs text-gray-600 font-semibold">c√≤n l·∫°i</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        const SHEET_ID = '1XRwutbGBYRj_gclLjcWc5E4sbP5nKdbehJfb8heWr-g';
        const SHEET_NAME = 'T·ªïng';
        const AUTO_REFRESH_INTERVAL = 10000;
        const TOTAL_SCHOOLS = 192;
        
        let schoolChart, teacherChart, pieChart;
        let autoRefreshEnabled = true;
        let autoRefreshTimer = null;
        let countdownTimer = null;
        let lastFetchTime = null;
        let isFetching = false;
        let previousData = null;
        let isDarkMode = false;
        let currentWeather = null;

        // ===== WEATHER FUNCTIONS =====
        async function fetchWeather() {
            try {
                const lat = 21.0285;
                const lon = 105.8542;
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code,is_day&timezone=Asia/Bangkok`);
                const data = await response.json();
                
                if (data.current) {
                    currentWeather = {
                        temp: Math.round(data.current.temperature_2m),
                        humidity: data.current.relative_humidity_2m,
                        code: data.current.weather_code,
                        isDay: data.current.is_day === 1
                    };
                    
                    updateWeatherDisplay();
                    updateWeatherBackground();
                    autoAdjustThemeByTime();
                }
            } catch (error) {
                console.error('Weather fetch error:', error);
                const now = new Date();
                const hour = now.getHours();
                currentWeather = {
                    temp: 25,
                    code: 0,
                    isDay: hour >= 6 && hour < 18
                };
                updateWeatherDisplay();
                updateWeatherBackground();
                autoAdjustThemeByTime();
            }
        }

        function autoAdjustThemeByTime() {
            if (!currentWeather) return;
            
            const shouldBeDark = !currentWeather.isDay;
            
            if (shouldBeDark && !isDarkMode) {
                isDarkMode = true;
                document.body.classList.add('dark-mode');
                updateThemeButton();
            } else if (!shouldBeDark && isDarkMode) {
                isDarkMode = false;
                document.body.classList.remove('dark-mode');
                updateThemeButton();
            }
        }

        function updateThemeButton() {
            const icon = document.getElementById('themeIcon');
            const text = document.getElementById('themeText');
            
            if (isDarkMode) {
                icon.textContent = '‚òÄÔ∏è';
                text.textContent = 'Ch·∫ø ƒë·ªô s√°ng';
            } else {
                icon.textContent = 'üåô';
                text.textContent = 'Ch·∫ø ƒë·ªô t·ªëi';
            }
        }

        function getWeatherInfo(code) {
            const weatherCodes = {
                0: { icon: '‚òÄÔ∏è', desc: 'Tr·ªùi quang', type: 'clear' },
                1: { icon: 'üå§Ô∏è', desc: 'Tr·ªùi ƒë·∫πp', type: 'clear' },
                2: { icon: '‚õÖ', desc: 'C√≥ m√¢y', type: 'cloudy' },
                3: { icon: '‚òÅÔ∏è', desc: 'Nhi·ªÅu m√¢y', type: 'cloudy' },
                45: { icon: 'üå´Ô∏è', desc: 'C√≥ s∆∞∆°ng m√π', type: 'fog' },
                48: { icon: 'üå´Ô∏è', desc: 'S∆∞∆°ng m√π d√†y', type: 'fog' },
                51: { icon: 'üå¶Ô∏è', desc: 'M∆∞a ph√πn nh·∫π', type: 'drizzle' },
                61: { icon: 'üåßÔ∏è', desc: 'M∆∞a nh·∫π', type: 'rain' },
                63: { icon: 'üåßÔ∏è', desc: 'M∆∞a v·ª´a', type: 'rain' },
                65: { icon: 'üåßÔ∏è', desc: 'M∆∞a to', type: 'rain-heavy' },
                71: { icon: 'üå®Ô∏è', desc: 'Tuy·∫øt nh·∫π', type: 'snow' },
                73: { icon: 'üå®Ô∏è', desc: 'Tuy·∫øt v·ª´a', type: 'snow' },
                75: { icon: 'üå®Ô∏è', desc: 'Tuy·∫øt d√†y', type: 'snow' },
                80: { icon: 'üå¶Ô∏è', desc: 'M∆∞a r√†o', type: 'rain' },
                95: { icon: '‚õàÔ∏è', desc: 'Gi√¥ng b√£o', type: 'thunderstorm' },
                96: { icon: '‚õàÔ∏è', desc: 'B√£o c√≥ m∆∞a ƒë√°', type: 'thunderstorm' }
            };
            
            return weatherCodes[code] || { icon: 'üå§Ô∏è', desc: 'Th·ªùi ti·∫øt ƒë·∫πp', type: 'clear' };
        }

        function updateWeatherDisplay() {
            if (!currentWeather) return;
            
            const info = getWeatherInfo(currentWeather.code);
            document.getElementById('weatherIcon').textContent = info.icon;
            document.getElementById('weatherDesc').textContent = info.desc;
            document.getElementById('weatherTemp').textContent = `${currentWeather.temp}¬∞C - H√† N·ªôi`;
        }

        function updateWeatherBackground() {
            if (!currentWeather) return;
            
            const bg = document.getElementById('weatherBackground');
            const info = getWeatherInfo(currentWeather.code);
            
            bg.innerHTML = '';
            
            let gradient;
            if (isDarkMode || !currentWeather.isDay) {
                gradient = 'linear-gradient(to bottom, #0f172a 0%, #1e293b 50%, #334155 100%)';
                createStars(bg, 100);
                
                const moon = document.createElement('div');
                moon.className = 'celestial';
                moon.style.background = 'radial-gradient(circle, #f0f0f0 0%, #d0d0d0 100%)';
                moon.style.boxShadow = '0 0 60px rgba(240, 240, 240, 0.6)';
                bg.appendChild(moon);
            } else {
                if (info.type === 'clear') {
                    gradient = 'linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 50%, #FFF4E6 100%)';
                } else if (info.type === 'cloudy') {
                    gradient = 'linear-gradient(to bottom, #A0B4C8 0%, #D4E1ED 50%, #E8F1F7 100%)';
                } else if (info.type.includes('rain') || info.type === 'thunderstorm') {
                    gradient = 'linear-gradient(to bottom, #5A6C7D 0%, #8B98A8 50%, #B0BCC9 100%)';
                } else if (info.type === 'fog') {
                    gradient = 'linear-gradient(to bottom, #B8C6D3 0%, #D8E1E9 50%, #EDF2F7 100%)';
                }
                
                const sun = document.createElement('div');
                sun.className = 'celestial';
                sun.style.background = 'radial-gradient(circle, #FFD700 0%, #FFA500 100%)';
                sun.style.boxShadow = '0 0 60px rgba(255, 215, 0, 0.8)';
                bg.appendChild(sun);
            }
            
            bg.style.background = gradient;
            
            switch (info.type) {
                case 'rain':
                case 'drizzle':
                    createRain(bg, 100);
                    break;
                case 'rain-heavy':
                    createRain(bg, 200);
                    break;
                case 'snow':
                    createSnow(bg, 50);
                    break;
                case 'thunderstorm':
                    createRain(bg, 150);
                    createLightning(bg);
                    break;
                case 'fog':
                    createFog(bg);
                    break;
                case 'cloudy':
                    createClouds(bg, 5);
                    break;
            }
        }

        function createRain(container, count) {
            for (let i = 0; i < count; i++) {
                const rain = document.createElement('div');
                rain.className = 'rain';
                rain.style.left = Math.random() * 100 + '%';
                rain.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
                rain.style.animationDelay = Math.random() * 2 + 's';
                rain.style.opacity = Math.random() * 0.5 + 0.3;
                container.appendChild(rain);
            }
        }

        function createSnow(container, count) {
            for (let i = 0; i < count; i++) {
                const snow = document.createElement('div');
                snow.className = 'snow';
                snow.style.left = Math.random() * 100 + '%';
                snow.style.animationDuration = (Math.random() * 3 + 3) + 's';
                snow.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(snow);
            }
        }

        function createClouds(container, count) {
            for (let i = 0; i < count; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                cloud.style.width = (Math.random() * 100 + 100) + 'px';
                cloud.style.height = (Math.random() * 40 + 40) + 'px';
                cloud.style.top = (Math.random() * 40) + '%';
                cloud.style.left = -150 + 'px';
                cloud.style.animationDuration = (Math.random() * 30 + 30) + 's';
                cloud.style.animationDelay = Math.random() * 10 + 's';
                container.appendChild(cloud);
            }
        }

        function createFog(container) {
            for (let i = 0; i < 3; i++) {
                const fog = document.createElement('div');
                fog.className = 'fog';
                fog.style.top = (i * 200) + 'px';
                fog.style.animationDelay = (i * 5) + 's';
                container.appendChild(fog);
            }
        }

        function createLightning(container) {
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const lightning = document.createElement('div');
                    lightning.className = 'lightning';
                    container.appendChild(lightning);
                    setTimeout(() => lightning.remove(), 200);
                }
            }, 3000);
        }

        function createStars(container, count) {
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 60 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(star);
            }
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            
            const icon = document.getElementById('themeIcon');
            const text = document.getElementById('themeText');
            
            if (isDarkMode) {
                icon.textContent = '‚òÄÔ∏è';
                text.textContent = 'Ch·∫ø ƒë·ªô s√°ng';
            } else {
                icon.textContent = 'üåô';
                text.textContent = 'Ch·∫ø ƒë·ªô t·ªëi';
            }
            
            updateWeatherBackground();
        }

        // ===== DATA FUNCTIONS =====
        function dataHasChanged(newData) {
            if (!previousData) return true;
            
            return previousData.approvedInstall !== newData.approvedInstall ||
                   previousData.installed !== newData.installed ||
                   previousData.remainingTeachers !== newData.remainingTeachers ||
                   previousData.schoolsInstalled !== newData.schoolsInstalled ||
                   previousData.moreThan10PC !== newData.moreThan10PC ||
                   previousData.install36 !== newData.install36 ||
                   previousData.install72 !== newData.install72 ||
                   previousData.install108 !== newData.install108;
        }

        function parseValue(cellValue) {
            if (cellValue === null || cellValue === undefined) return 0;
            if (typeof cellValue === 'number') return cellValue;
            
            if (typeof cellValue === 'string') {
                cellValue = cellValue.trim();
                if (cellValue.includes('C√≤n L·∫°i:')) {
                    const match = cellValue.match(/C√≤n L·∫°i:\s*(\d+)/i);
                    return match ? parseInt(match[1]) : 0;
                }
                if (cellValue.includes('/')) {
                    const match = cellValue.match(/(\d+)\s*\//);
                    return match ? parseInt(match[1]) : 0;
                }
                const numMatch = cellValue.match(/^(\d+)/);
                if (numMatch) return parseInt(numMatch[1]);
                const num = parseInt(cellValue.replace(/\D/g, ''));
                return isNaN(num) ? 0 : num;
            }
            return 0;
        }

        function startCountdown() {
            const countdownContainer = document.getElementById('countdownContainer');
            const countdownCircle = document.getElementById('countdownCircle');
            const countdownNumber = document.getElementById('countdownNumber');
            const countdownText = document.getElementById('countdownText');
            
            countdownContainer.classList.remove('hidden');
            countdownCircle.classList.remove('warning');
            countdownNumber.classList.remove('warning');
            countdownText.classList.remove('warning');
            
            let timeLeft = AUTO_REFRESH_INTERVAL / 1000;
            const totalTime = AUTO_REFRESH_INTERVAL / 1000;
            const circumference = 2 * Math.PI * 20;
            
            countdownCircle.setAttribute('stroke-dasharray', circumference);
            countdownCircle.style.strokeDashoffset = '0';
            countdownNumber.textContent = timeLeft;
            countdownText.textContent = `sau ${timeLeft}s`;
            
            if (countdownTimer) clearInterval(countdownTimer);
            
            countdownTimer = setInterval(() => {
                timeLeft--;
                
                if (timeLeft >= 0) {
                    const progress = timeLeft / totalTime;
                    const offset = circumference * (1 - progress);
                    countdownCircle.style.strokeDashoffset = offset;
                    countdownNumber.textContent = timeLeft;
                    countdownText.textContent = `sau ${timeLeft}s`;
                    
                    if (timeLeft <= 3 && timeLeft > 0) {
                        countdownCircle.classList.add('warning');
                        countdownNumber.classList.add('warning');
                        countdownText.classList.add('warning');
                    } else {
                        countdownCircle.classList.remove('warning');
                        countdownNumber.classList.remove('warning');
                        countdownText.classList.remove('warning');
                    }
                }
                
                if (timeLeft < 0) {
                    clearInterval(countdownTimer);
                }
            }, 1000);
        }

        function stopCountdown() {
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
            }
            const countdownContainer = document.getElementById('countdownContainer');
            const countdownCircle = document.getElementById('countdownCircle');
            const countdownNumber = document.getElementById('countdownNumber');
            const countdownText = document.getElementById('countdownText');
            
            countdownContainer.classList.add('hidden');
            countdownCircle.classList.remove('warning');
            countdownNumber.classList.remove('warning');
            countdownText.classList.remove('warning');
        }

        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const btn = document.getElementById('autoRefreshBtn');
            const icon = document.getElementById('autoRefreshIcon');
            
            if (autoRefreshEnabled) {
                btn.className = 'btn-auto active flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl font-semibold transition-all shadow-lg hover:shadow-2xl border-2 border-green-400';
                icon.textContent = '‚ñ∂Ô∏è';
                
                fetchData();
                autoRefreshTimer = setInterval(() => {
                    fetchData();
                }, AUTO_REFRESH_INTERVAL);
                
                console.log('‚úÖ Auto-refresh B·∫¨T');
            } else {
                btn.className = 'btn-auto flex items-center gap-2 bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl font-semibold transition-all shadow-lg hover:shadow-xl border-2 border-gray-300';
                icon.textContent = '‚è∏Ô∏è';
                
                if (autoRefreshTimer) {
                    clearInterval(autoRefreshTimer);
                    autoRefreshTimer = null;
                }
                stopCountdown();
                
                console.log('‚è∏Ô∏è Auto-refresh T·∫ÆT');
            }
        }

        function manualRefresh() {
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
            }
            if (countdownTimer) {
                clearInterval(countdownTimer);
            }
            
            fetchData();
            
            if (autoRefreshEnabled) {
                autoRefreshTimer = setInterval(() => {
                    fetchData();
                }, AUTO_REFRESH_INTERVAL);
            }
        }

        async function fetchData() {
            if (isFetching) {
                console.log('‚è≠Ô∏è ƒêang fetch, b·ªè qua l·∫ßn n√†y');
                return;
            }
            
            isFetching = true;
            const btn = document.getElementById('refreshBtn');
            const icon = document.getElementById('refreshIcon');
            const statusBadge = document.getElementById('statusBadge');
            const lastUpdate = document.getElementById('lastUpdate');
            
            btn.disabled = true;
            icon.classList.add('spinning');
            
            statusBadge.className = 'status-badge loading';
            lastUpdate.textContent = 'ƒêang t·∫£i d·ªØ li·ªáu...';

            try {
                const cells = ['R4', 'R5', 'R6', 'O4', 'O9', 'O10', 'O12', 'O13', 'O14'];
                
                const responses = await Promise.all(
                    cells.map(cell => 
                        fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}&range=${cell}`, {
                            cache: 'no-cache'
                        })
                    )
                );
                
                const values = await Promise.all(
                    responses.map(async (response) => {
                        if (!response.ok) return 0;
                        const text = await response.text();
                        const json = JSON.parse(text.substring(47).slice(0, -2));
                        
                        if (json.table && json.table.rows && json.table.rows[0]) {
                            const cellValue = json.table.rows[0].c[0]?.v;
                            return parseValue(cellValue);
                        }
                        return 0;
                    })
                );
                
                const data = {
                    approvedInstall: values[0] || 0,
                    installed: values[1] || 0,
                    remainingTeachers: values[2] || 0,
                    totalRegistered: values[3] || TOTAL_SCHOOLS,
                    schoolsInstalled: values[4] || 0,
                    moreThan10PC: values[5] || 0,
                    install36: values[6] || 0,
                    install72: values[7] || 0,
                    install108: values[8] || 0
                };
                
                const hasChanged = dataHasChanged(data);
                
                if (hasChanged) {
                    console.log('üÜï Ph√°t hi·ªán d·ªØ li·ªáu m·ªõi - C·∫≠p nh·∫≠t UI');
                    updateUI(data);
                    previousData = {...data};
                    
                    statusBadge.className = 'status-badge success';
                    lastFetchTime = new Date();
                    const timeStr = lastFetchTime.toLocaleTimeString('vi-VN');
                    const autoStatus = autoRefreshEnabled ? ' üîÑ' : '';
                    lastUpdate.textContent = 'C·∫≠p nh·∫≠t: ' + timeStr + autoStatus;
                    
                    console.log('‚úÖ UI ƒë√£ c·∫≠p nh·∫≠t l√∫c', timeStr);
                } else {
                    console.log('‚è≠Ô∏è Kh√¥ng c√≥ thay ƒë·ªïi');
                    const timeStr = new Date().toLocaleTimeString('vi-VN');
                    const autoStatus = autoRefreshEnabled ? ' üîÑ' : '';
                    statusBadge.className = 'status-badge success';
                    lastUpdate.textContent = 'Ki·ªÉm tra: ' + timeStr + autoStatus;
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                statusBadge.className = 'status-badge error';
                lastUpdate.textContent = 'L·ªói: ' + error.message;
            } finally {
                isFetching = false;
                btn.disabled = false;
                
                setTimeout(() => {
                    icon.classList.remove('spinning');
                }, 800);
                
                if (autoRefreshEnabled) {
                    startCountdown();
                }
            }
        }

        function updateUI(data) {
            document.getElementById('totalSchools').textContent = TOTAL_SCHOOLS;
            document.getElementById('schoolsInstalled').textContent = data.schoolsInstalled;
            
            const schoolPercent = ((data.schoolsInstalled / TOTAL_SCHOOLS) * 100).toFixed(1);
            document.getElementById('schoolPercent').textContent = schoolPercent + '%';
            document.getElementById('schoolsInstalledSub').textContent = `${data.schoolsInstalled}/${TOTAL_SCHOOLS}`;
            
            document.getElementById('moreThan10').textContent = data.moreThan10PC;
            
            document.getElementById('installProgress').textContent = schoolPercent + '%';
            document.getElementById('installProgressSub').textContent = `${data.schoolsInstalled}/${TOTAL_SCHOOLS} tr∆∞·ªùng`;
            document.getElementById('installProgressBar').style.width = schoolPercent + '%';
            document.getElementById('installProgressText').textContent = schoolPercent + '%';
            
            document.getElementById('registered').textContent = data.approvedInstall;
            document.getElementById('installed').textContent = data.installed;
            
            const teacherPercent = data.approvedInstall > 0 
                ? ((data.installed / data.approvedInstall) * 100).toFixed(1) 
                : 0;
            document.getElementById('installedPercent').textContent = teacherPercent + '%';
            document.getElementById('installedSub').textContent = `${data.installed}/${data.approvedInstall}`;
            
            document.getElementById('remaining').textContent = data.remainingTeachers;
            const remainingPercent = data.approvedInstall > 0 
                ? ((data.remainingTeachers / data.approvedInstall) * 100).toFixed(1) 
                : 0;
            document.getElementById('remainingPercent2').textContent = remainingPercent + '%';
            
            document.getElementById('teacherProgress').textContent = teacherPercent + '%';
            document.getElementById('teacherProgressSub').textContent = `${data.installed}/${data.approvedInstall} GV`;
            document.getElementById('teacherProgressBar').style.width = teacherPercent + '%';
            document.getElementById('teacherProgressText').textContent = teacherPercent + '%';
            
            const totalPeriods = data.install36 + data.install72 + data.install108;
            
            document.getElementById('install36').textContent = data.install36;
            document.getElementById('percent36').textContent = totalPeriods > 0 
                ? ((data.install36 / totalPeriods) * 100).toFixed(1) + '%' 
                : '0%';
            
            document.getElementById('install72').textContent = data.install72;
            document.getElementById('percent72').textContent = totalPeriods > 0 
                ? ((data.install72 / totalPeriods) * 100).toFixed(1) + '%' 
                : '0%';
            
            document.getElementById('install108').textContent = data.install108;
            document.getElementById('percent108').textContent = totalPeriods > 0 
                ? ((data.install108 / totalPeriods) * 100).toFixed(1) + '%' 
                : '0%';

            document.getElementById('schoolCompletionRate').textContent = schoolPercent + '%';
            document.getElementById('schoolCompletionSub').textContent = `${data.schoolsInstalled}/${TOTAL_SCHOOLS} tr∆∞·ªùng`;
            
            document.getElementById('teacherCompletionRate').textContent = teacherPercent + '%';
            document.getElementById('teacherCompletionSub').textContent = `${data.installed}/${data.approvedInstall} GV`;
            
            const daysElapsed = 30;
            const speedPerDay = (data.installed / daysElapsed).toFixed(1);
            document.getElementById('deploymentSpeed').textContent = speedPerDay;
            
            if (data.remainingTeachers > 0 && speedPerDay > 0) {
                const daysRemaining = Math.ceil(data.remainingTeachers / speedPerDay);
                document.getElementById('estimatedCompletion').textContent = `~${daysRemaining} ng√†y`;
            } else {
                document.getElementById('estimatedCompletion').textContent = '‚úÖ Xong';
            }

            updateCharts(data);
        }

        function updateCharts(data) {
            if (schoolChart) schoolChart.destroy();
            if (teacherChart) teacherChart.destroy();
            if (pieChart) pieChart.destroy();

            const schoolCtx = document.getElementById('schoolChart').getContext('2d');
            schoolChart = new Chart(schoolCtx, {
                type: 'bar',
                data: {
                    labels: ['T·ªïng tr∆∞·ªùng', 'ƒê√£ c√†i ƒë·∫∑t', 'M√°y > 10'],
                    datasets: [{
                        label: 'S·ªë l∆∞·ª£ng',
                        data: [TOTAL_SCHOOLS, data.schoolsInstalled, data.moreThan10PC],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.85)',
                            'rgba(99, 102, 241, 0.85)',
                            'rgba(139, 92, 246, 0.85)'
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(99, 102, 241, 1)',
                            'rgba(139, 92, 246, 1)'
                        ],
                        borderWidth: 3,
                        borderRadius: 10,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            padding: 16,
                            titleFont: { size: 16, weight: 'bold' },
                            bodyFont: { size: 14 },
                            cornerRadius: 12
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: { font: { size: 12, weight: '600' }, color: '#4b5563' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 11, weight: '600' }, color: '#4b5563' }
                        }
                    }
                }
            });

            const teacherCtx = document.getElementById('teacherChart').getContext('2d');
            teacherChart = new Chart(teacherCtx, {
                type: 'bar',
                data: {
                    labels: ['GV ƒëƒÉng k√Ω', 'GV ƒë√£ c√†i', 'GV c√≤n l·∫°i'],
                    datasets: [{
                        label: 'S·ªë l∆∞·ª£ng',
                        data: [data.approvedInstall, data.installed, data.remainingTeachers],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.85)',
                            'rgba(20, 184, 166, 0.85)',
                            'rgba(249, 115, 22, 0.85)'
                        ],
                        borderColor: [
                            'rgba(16, 185, 129, 1)',
                            'rgba(20, 184, 166, 1)',
                            'rgba(249, 115, 22, 1)'
                        ],
                        borderWidth: 3,
                        borderRadius: 10,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            padding: 16,
                            titleFont: { size: 16, weight: 'bold' },
                            bodyFont: { size: 14 },
                            cornerRadius: 12
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: { font: { size: 12, weight: '600' }, color: '#4b5563' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 11, weight: '600' }, color: '#4b5563' }
                        }
                    }
                }
            });

            const pieCtx = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: ['36 ti·∫øt', '72 ti·∫øt', '108 ti·∫øt'],
                    datasets: [{
                        data: [data.install36, data.install72, data.install108],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.9)',
                            'rgba(34, 197, 94, 0.9)',
                            'rgba(251, 191, 36, 0.9)'
                        ],
                        borderColor: '#fff',
                        borderWidth: 4,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 14, weight: '600' },
                                color: '#374151',
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            padding: 16,
                            cornerRadius: 12,
                            titleFont: { size: 16, weight: 'bold' },
                            bodyFont: { size: 14 },
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                    return `${context.label}: ${value} tr∆∞·ªùng (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        window.onload = () => {
            console.log('üöÄ Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng...');
            
            fetchWeather();
            setInterval(fetchWeather, 600000);
            
            fetchData();
            autoRefreshTimer = setInterval(() => {
                fetchData();
            }, AUTO_REFRESH_INTERVAL);
        };
    </script>
</body>
</html>      